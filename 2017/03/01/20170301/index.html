<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Jay,362359635@qq.com"><title>Webpack入坑笔记(二) 小图片优化,引入CSS,使用ES6 · CloudJay's Blog</title><meta name="description" content="今天我要进一步深入的了解webpack的各种功能,webpack有着无数插件可以为项目提供各种支持,其中一部分对项目文件进行预处理的插件叫做loader(预处理器),比较常用的有:

css预编译,less或sass预编译 css-loader,style-loader,less-loader 把c"><meta name="keywords" content="Hexo,HTML,CSS,JavaScript,CloudJay"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?93cbe2c7c0e4e50f9857981ad68ffbb2";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">CloudJay's Blog</a></h3><div class="description"><p>做一个爱游戏爱生活的前端程序猿.</p></div></div></div><ul class="social-links"></ul><div class="footer"><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a><span>+</span><a href="https://github.com/Ben02/hexo-theme-Anatole">Anatole</a><span>&#65281;</span></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"></a></li></div><div class="avatar"><img src="http://ww1.sinaimg.cn/thumbnail/45f387ebgy1fcz7980walj20xc0tb7bi"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Webpack入坑笔记(二) 小图片优化,引入CSS,使用ES6</a></h3></div><div class="post-content"><p>今天我要进一步深入的了解webpack的各种功能,webpack有着无数插件可以为项目提供各种支持,其中一部分对项目文件进行预处理的插件叫做loader(预处理器),比较常用的有:</p>
<ol>
<li>css预编译,less或sass预编译 css-loader,style-loader,less-loader 把css预编译并通过style标签嵌入到页面</li>
<li>小图片优化生成base64码 url-loader 减少请求数</li>
<li>使用Jquery等类库</li>
<li>支持ES6语法 babel-loader <del>装逼</del>(使用新特性提供开发效率)</li>
<li>代码压缩 节约流量</li>
</ol>
<p>我们分别来尝试一下以上提到的功能</p>
<h1 id="css预编译"><a href="#css预编译" class="headerlink" title="css预编译"></a>css预编译</h1><p>在我们的app目录下新建一个文件夹css /app/css/ 用来存放我们的CSS文件,新建一个main.css文件</p>
<h2 id="main-css"><a href="#main-css" class="headerlink" title="main.css"></a>main.css</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">h1</span>&#123;</div><div class="line">  <span class="attribute">color</span>:blue;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>安装预处理器 style-loader,css-loader</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install style-loader css-loader --save-dev //一行命令要安装多个插件,可以用空格隔开</div></pre></td></tr></table></figure>
<p>安装完成后,配置webpack.config,注意以下几点:</p>
<ol>
<li>所有的预处理器的处理顺序是从后往前(从右到左)</li>
<li><p>在webpack 2.0版本后,预处理器不能省略-loader,例如:’style-loader’不能简写为’style’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">module:&#123;</div><div class="line"><span class="attr">loaders</span>:[&#123;</div><div class="line"><span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</div><div class="line"><span class="attr">loaders</span>:[<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>],</div><div class="line"><span class="attr">include</span>:APP_PATH</div><div class="line">&#125;]</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ol>
<p>不要忘了在index.js引用我们的css文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'./css/main.css'</span>)</div></pre></td></tr></table></figure>
<p>然后执行npm start,你应该能看到蓝色的hello world字样了<br> <img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd7cg8k5n2j209l03jweb" alt=""></p>
<h1 id="使用Less"><a href="#使用Less" class="headerlink" title="使用Less"></a>使用Less</h1><p>让我们接着上一步,如果我要使用sass或者less,应该怎么办呢,答案也非常简单,只需安装less预处理器,并在配置文件里配置对less的预处理即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm installless-loader --save-dev</div></pre></td></tr></table></figure>
<p>webpack.config配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>:[</div><div class="line">  ...</div><div class="line">  &#123;</div><div class="line">    <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,</div><div class="line">    <span class="attr">loader</span>:[<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>,<span class="string">'less-loader'</span>] <span class="comment">//是不是非常简单,只需要在预处理程序上加一道即可</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">]</div></pre></td></tr></table></figure>
<p>在/app/下新建目录 /app/less,新建文件main.less<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@base:</span> red;</div><div class="line"><span class="selector-tag">h1</span> &#123;</div><div class="line">    <span class="attribute">color</span>: <span class="variable">@base</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="selector-tag">h2</span> &#123;</div><div class="line">  <span class="attribute">color</span>:blue;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在index.js中修改引用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'./less/main.less'</span>);</div></pre></td></tr></table></figure></p>
<p>然后 npm start,编译成功!又看到了熟悉的hello world,只不过这次第一行变成了红色,第二行变成了蓝色</p>
<p><img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd7e9jvi4cj209y03sweb" alt=""></p>
<h1 id="小图片优化"><a href="#小图片优化" class="headerlink" title="小图片优化"></a>小图片优化</h1><p>首先我们在我们的目录下新建一个文件夹 /app/images/ 用来存放我们的图片,这里我选用了2张猫咪的图片,一张有270kb,另一张则是21.6kb.我们的目标是当浏览器加载40KB以下的图片时,把图片转化成dataurl,这样可以减少请求数,提高网页加载的速度.先看下没有预处理器下,图片的处理情况</p>
<p>我们的文件目录结构:</p>
<p><img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd7gmksagmj206w0ek74l" alt=""></p>
<p>我们在less中为h1,h2增加背景图片<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@base:</span> red;</div><div class="line"><span class="variable">@height:</span> <span class="number">300px</span>;</div><div class="line"></div><div class="line"><span class="selector-tag">h1</span> &#123;</div><div class="line">    <span class="attribute">color</span>: <span class="variable">@base</span>;</div><div class="line">    <span class="attribute">background</span>: url(<span class="string">'../images/p1.jpg'</span>) no-repeat;</div><div class="line">    <span class="attribute">background-size</span>:;</div><div class="line">    <span class="attribute">height</span>: <span class="variable">@height</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="selector-tag">h2</span> &#123;</div><div class="line">    <span class="attribute">color</span>:blue;</div><div class="line">    <span class="attribute">background</span>: url(<span class="string">'../images/p2.jpeg'</span>) no-repeat;</div><div class="line">    <span class="attribute">background-size</span>: contain;</div><div class="line">    <span class="attribute">height</span>: <span class="variable">@height</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们在html中用<img>标签也添加一张图片,这里应该通过JS来生成到html中,我们添加一个组件images.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printIMG</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> div=<span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  div.innerHTML=<span class="string">'Here is a picture from js&lt;br&gt;'</span></div><div class="line">  div.innerHTML+=<span class="string">'&lt;img src="/app/images/p1.JPG"&gt;'</span>;</div><div class="line">  <span class="keyword">return</span> div;</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports=printIMG;</div></pre></td></tr></table></figure></p>
<p>在index.js中引用它,注意我们这里还有个同名的images目录,但webpack自动识别了require中的images.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'./less/main.less'</span>);</div><div class="line"><span class="keyword">var</span> sub=<span class="built_in">require</span>(<span class="string">'./sub'</span>);</div><div class="line"><span class="keyword">var</span> img=<span class="built_in">require</span>(<span class="string">'./images'</span>);</div><div class="line"><span class="keyword">var</span> app=<span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">app.innerHTML=<span class="string">'&lt;h1&gt;Hello World 1111111&lt;/h1&gt;'</span>;</div><div class="line">app.appendChild(sub());</div><div class="line">app.appendChild(img());</div><div class="line"><span class="built_in">document</span>.body.appendChild(app);</div></pre></td></tr></table></figure></p>
<p>运行webpack后,我们看到页面上多了3张图片,查看HTML和CSS后,发现现在所有图片都是直接引用的url</p>
<p><img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd7h4hvdvqj20zc0q6nd8" alt=""></p>
<p>然而我们的需求是要把40KB以下的图片全部转化成base64的形式,现在我们使用url-loader来做这件事,<br>首先,安装插件 url-loader<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install url-loader --save-dev</div></pre></td></tr></table></figure></p>
<p>然后在webpack.config中配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">module: &#123;</div><div class="line">  <span class="attr">loaders</span>: [</div><div class="line">    ...</div><div class="line">    &#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg)$/</span>, <span class="comment">//可以定义多种格式</span></div><div class="line">      loader: <span class="string">'url-loader?limit=40000?name=images/[name].[ext]'</span> <span class="comment">//在预处理器后可以通过?增加参数,这里?limit=40000的意思是把所有40000b以下的图片转化成base64格式</span></div><div class="line">    &#125;,</div><div class="line">    ...</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>然后让我们再运行下看看结果<br><img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd7hbirsslj20zc0t1kaw" alt=""><br>这个时候我们发现background里的图片已经变成base64格式了(见框1),但框2中的img标签里同样的图片却没有转化.<br>这是由于url-loader不支持打包JS里的src导致的,为了打包时候不丢失图片,我们可以通过require的方式引用图片,这样就可以通过url-loader来打包了,把images.js改一下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> imgUrl= <span class="built_in">require</span>(<span class="string">'./images/p1.jpg'</span>);<span class="comment">//注意!后缀名必须是小写,大写会报错</span></div><div class="line"><span class="keyword">var</span> imgTemp=<span class="string">'&lt;img src="'</span>+imgUrl+<span class="string">'" /&gt;'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printIMG</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> div=<span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  div.innerHTML=<span class="string">'Here is a picture from j11111111111s&lt;br&gt;'</span></div><div class="line">  div.innerHTML+=imgTemp;</div><div class="line">  <span class="keyword">return</span> div;</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports=printIMG;</div></pre></td></tr></table></figure></p>
<h2 id="使用Jquery等类库"><a href="#使用Jquery等类库" class="headerlink" title="使用Jquery等类库"></a>使用Jquery等类库</h2><p>如果要在项目中使用各种类库,步骤也是和安装插件一样的<br>首先<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install jquery --save</div></pre></td></tr></table></figure></p>
<p>然后在需要使用jquery的页面上require一下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $=<span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line">...</div><div class="line">$(<span class="string">'body'</span>).append(<span class="string">'&lt;p&gt;Jquery is work now&lt;/p&gt;'</span>);</div></pre></td></tr></table></figure></p>
<p>这里笔者产生了一个问题,为什么require(‘jquery’)就能直接找到node_modules下的jquery文件呢<br>这是因为如果require中的内容如果不包含’/‘、’./‘或’../‘开头的话,默认会先寻找node_modules目录下的相关文件,这里的require(‘jquery’)等价于 require(‘./node_modules/jquery’)<br>参考:<a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="external">阮大神的文章</a></p>
<blockquote>
<p>当 Node 遇到 require(X) 时，按下面的顺序处理。<br> （1）如果 X 是内置模块（比如 require(‘http’）)<br> 　　a. 返回该模块。<br> 　　b. 不再继续执行。<br> （2）如果 X 以 “./“ 或者 “/“ 或者 “../“ 开头<br> 　　a. 根据 X 所在的父模块，确定 X 的绝对路径。<br> 　　b. 将 X 当成文件，依次查找下面文件，只要其中有一个存在，就返回该文件，不再继续执行。</p>
<blockquote>
<p> X<br> X.js<br> X.json<br> X.node</p>
</blockquote>
<p> 　　c. 将 X 当成目录，依次查找下面文件，只要其中有一个存在，就返回该文件，不再继续执行。</p>
<blockquote>
<p>X/package.json（main字段）<br> X/index.js<br> X/index.json<br> X/index.node</p>
</blockquote>
<p> （3）如果 X 不带路径<br> 　　a. 根据 X 所在的父模块，确定 X 可能的安装目录。<br> 　　b. 依次在每个目录中，将 X 当成文件名或目录名加载。<br> （4） 抛出 “not found”</p>
</blockquote>
<p>运行后,可以看到,Jquery的代码已经成功输出了!<br><img src="http://ww1.sinaimg.cn/large/45f387ebgy1fd8coatsopj20h70p8n9b" alt=""></p>
<h2 id="支持ES6语法-babel-loader"><a href="#支持ES6语法-babel-loader" class="headerlink" title="支持ES6语法 babel-loader"></a>支持ES6语法 babel-loader</h2><p>如果想要使用es6,我们需要安装babel编译器,他可以把ES6语法解析成浏览器能兼容的JavaScript,我们还要安装适用于babel的ES2015语法转换器(babel-preset-es2015)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-loader babel-preset-es2015 --save-dev</div></pre></td></tr></table></figure></p>
<p>在webpack.config中配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">&#123;</div><div class="line">  <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">  <span class="attr">loader</span>: <span class="string">'babel-loader'</span>,</div><div class="line">  <span class="attr">exclude</span>: <span class="regexp">/(node_modules|bower_components)/</span>,</div><div class="line">  <span class="attr">query</span>: &#123;</div><div class="line">    <span class="attr">presets</span>: [<span class="string">'es2015'</span>] <span class="comment">//表示使用es2015语法转换器</span></div><div class="line">  &#125;</div><div class="line">&#125;,</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>关于babel-loader的设置可以参考 <a href="https://www.npmjs.com/package/babel-loader" target="_blank" rel="external">这里</a></p>
<p>然后我们修改下原来的js文件,可以使用ES6语法了</p>
<h3 id="sub-js"><a href="#sub-js" class="headerlink" title="sub.js"></a>sub.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> h2=<span class="built_in">document</span>.createElement(<span class="string">'h2'</span>);</div><div class="line">  h2.innerHTML=<span class="string">'Hello World h2'</span>;</div><div class="line">  <span class="keyword">return</span> h2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="images-js"><a href="#images-js" class="headerlink" title="images.js"></a>images.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> imgUrl <span class="keyword">from</span> <span class="string">'./images/p1.jpg'</span>;</div><div class="line"><span class="keyword">let</span> imgTemp=<span class="string">'&lt;img src="'</span>+imgUrl+<span class="string">'" /&gt;'</span>;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">let</span> div=<span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  div.innerHTML=<span class="string">'Here is a picture from j11111111111s&lt;br&gt;'</span></div><div class="line">  div.innerHTML+=imgTemp;</div><div class="line">  <span class="keyword">return</span> div;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ES6风格</span></div><div class="line"><span class="keyword">import</span> <span class="string">'./less/main.less'</span>;</div><div class="line"><span class="keyword">import</span> sub <span class="keyword">from</span> <span class="string">'./sub'</span>;</div><div class="line"><span class="keyword">import</span> images <span class="keyword">from</span> <span class="string">'./images'</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</div><div class="line"></div><div class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line"><span class="keyword">const</span> myPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'执行完成'</span>);</div><div class="line">    resolve(<span class="string">'101'</span>);</div><div class="line">  &#125;,<span class="number">5000</span>);</div><div class="line">&#125;);</div><div class="line">myPromise.then(<span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</div><div class="line">  $(<span class="string">'body'</span>).append(<span class="string">'&lt;p&gt;promise result is '</span> + value + <span class="string">' now is'</span> + moment().format(<span class="string">'YYYY-MM-DD hh:mm:sss'</span>)+<span class="string">'&lt;/p&gt;'</span>);</div><div class="line">&#125;);</div><div class="line">app.innerHTML=<span class="string">'&lt;h1&gt;Hello world H1&lt;/h1&gt;'</span>;</div><div class="line"><span class="built_in">document</span>.body.appendChild(app);</div><div class="line">app.appendChild(sub());</div><div class="line">app.appendChild(images());</div></pre></td></tr></table></figure>
<p>运行一下,依然是我们熟悉的hello world,并且promise的结果也print出来了.</p>
<h2 id="代码压缩"><a href="#代码压缩" class="headerlink" title="代码压缩"></a>代码压缩</h2><p>现在我们对webpack基本的功能都有一定的了解了,最后生成项目的时候,页面里的js和css都是未经过压缩的,并且我们所引用到的类库都被打包到了bundle.js里,导致这个JS文件非常大,在实际生成项目中,我们通常只上线自己所写的JS代码,所有的类库都会缓存到CDN上来分流,这个需求在webpack中也是可以实现的.首先我们来拆分项目中的Jquery和Moment 这2个库</p>
<p>修改webpack.config,添加externals属性可以在webpack打包时排除在externals下的依赖包<br>例如:我们排除jquery和moment,这样在webpack打包时就不会把这2个库打包到bundle.js下了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">externals:[</div><div class="line">   &#123;<span class="string">'jquery'</span>:<span class="string">'jQuery'</span>,<span class="string">'moment'</span>:<span class="string">'moment'</span>&#125;,</div><div class="line">],</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p><img src="https://ws1.sinaimg.cn/large/45f387ebgy1fd8jzmcwgcj20it0bidhe" alt=""></p>
<p>我们可以在template模板中对未打包的文件进行设置,比如设置CDN,我这里由于没有CDN,就用node_modules代替了<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">hello this is from template</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/jquery/dist/jquery.min.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/moment/min/moment.min.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>另一种压缩是对js本身进行的压缩 可以通过webpack自带的插件进行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">plugins:[</div><div class="line">  <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;<span class="comment">//压缩JS</span></div><div class="line">    compress:&#123;</div><div class="line">      <span class="attr">warnings</span>:<span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;),</div><div class="line">]</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>运行weback 打包后的文件更小了<br><img src="https://ws1.sinaimg.cn/large/45f387ebgy1fd8l2a8okoj20it0cggn8" alt=""></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-03-01</span><i class="fa fa-comment-o"></i><a href="/2017/03/01/20170301/#comments">评论</a><i class="fa fa-tag"></i><a href="/tags/webpack/" title="webpack" class="tag">webpack </a></div></div></div></div><div class="share"><div class="evernote"> <a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"> <a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"> <a href="http://twitter.com/home?status=,http://blog.cloudjay.net/2017/03/01/20170301/,CloudJay's Blog,Webpack入坑笔记(二) 小图片优化,引入CSS,使用ES6,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2017/03/07/201703071741/" title="前端面试题" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2017/02/28/Webpack入坑笔记-一/" title="Webpack入坑笔记(一) 安装webpack和插件,执行编译任务" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div data-thread-key="2017/03/01/20170301/" data-title="Webpack入坑笔记(二) 小图片优化,引入CSS,使用ES6" data-url="http://blog.cloudjay.net/2017/03/01/20170301/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"cloudjay"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>